---
import Layout from '../layouts/Layout.astro';
import EpisodeList from '../components/EpisodeList.astro';
import { getAllEpisodes, getShowInfo } from '../lib/rss';
import type { Episode, Show } from '../lib/rss';
import starpodConfig from '../../starpod.config';
const feed = Astro.url.searchParams.get('feed') || Astro.url.searchParams.get('url') || undefined;
let episodes: Array<Episode> = [];
let show: Show = {
  title: 'Starpod',
  description: starpodConfig.description,
  image: '',
  link: ''
};

try {
  episodes = await getAllEpisodes(feed);
  show = await getShowInfo(feed);
} catch {
  // Keep fallback values so the page still renders instead of returning a 500.
}
const title = `${show.title}`;
---

<Layout title={title}>
  <div class="relative z-10 px-8 lg:px-18">
    <h1 class="text-light-text-heading text-4xl font-bold dark:text-white">
      Episodes
    </h1>

    <EpisodeList episodes={episodes} show={show} feed={feed} />
  </div>
</Layout>
